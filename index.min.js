var http=require("http"),url=require("url"),fs=require("fs"),jsonfile=require("jsonfile"),dataerrcall={html:"js",js:"css",css:"none"},urldataarray={path:"n/a",extension:"n/a",place:"n/a"},pathdataarray={path:"",levels:0},timeunitarray=["year","month","day","hour","minute","second"],timedataarray=[null],timestampvar=new Date,tmpdata,tmpchar="",tmpnum=0,tmparray={},settings,data,alertsetting={type:"",text:"",deny:"true"};http.createServer(function(a,t){function e(a,e){if(void 0==e&&(e=""),"none"==a){console.log("path: "+pathdataarray[1]),"/pre"==pathdataarray[1]&&(console.log("substr"),o=d.substr(4,d.length-5),console.log("1: "+o)),n(s.pathname,""),console.log("slug: "+e+" filename: "+o),""!=e||void 0!=o?(console.log("what?"),o=""!=o?"."+o:"."+e,console.log("2: "+o)):o="."+d.substr(0,d.length-1),console.log("filename: "+o),fs.readFile(o,function(a,e){if(a)return console.log("404 err"),t.writeHead(404),t.write("The path"+s.pathname+"is not found <br />"),t.end("404 not found");var r=null;return r="js"==urldataarray.extension?"javascript":urldataarray.extension,"/pre"==pathdataarray[1]?(t.writeHead(200,{"Content-Type":"text/plain"}),console.log("--------need pre"),t.write(e),t.end()):"/data"==pathdataarray[1]?(t.writeHead(403),t.end("403 Forbidden")):(t.writeHead(200,{"Content-Type":"text/"+r}),t.write(e),t.end())})}else{n(s.pathname,a);var o;"/pre"==pathdataarray[1]&&(console.log("substr"),o=d.substr(4,d.length-5),console.log("11: "+o)),console.log("2slug: "+e+" filename: "+o),""!=e||void 0!=o?(o=""!=o?"."+o+"."+a:"."+e+"."+a,console.log("22: "+o)):o="."+d.substr(0,d.length-1)+"."+a,fs.readFile(o,function(e,n){if(e)return r(dataerrcall[a]);var o=null;return"js"==urldataarray.extension?o="javascript":(o=urldataarray.extension,console.log("ok")),"/pre"==pathdataarray[1]?(t.writeHead(200,{"Content-Type":"text/plain"}),t.write(n)):(t.writeHead(200,{"Content-Type":"text/"+o}),console.log("pure data"),t.write(n)),t.end()})}}function r(a,t){e(a,t)}function n(a,t){if(""!=t&&(p=t),a=a.substr(0,a.length-1),urldataarray.path=a,""!=p)urldataarray.extension=p;else{for(tmpdata=a.length,i=0;i<999;i++)if(tmpnum=tmpdata-i,"."==a.substr(tmpnum,1)){tmpnum=i;break}urldataarray.extension=a.substr(tmpdata-tmpnum+1,tmpdata+1-tmpdata+tmpnum-1)}"http://"==a.substr(0,6)||"https://"==a.substr(0,7)||"//"==a.substr(0,1)?urldataarray.place="external":urldataarray.place="local",urldataarray.path=urldataarray.path}function o(a){for(tmpdata=0,tmpnum=0,i=1;i<50&&"."!=a.substr(i,1);i++)"/"==a.substr(i,1)&&(pathdataarray[++tmpnum]=a.substr(tmpdata,i-tmpdata),tmpdata+=pathdataarray[tmpnum].length,pathdataarray.levels++);pathdataarray.path=a}function l(){function a(a){for(i=0;i<data.global.header[a].length;i++)"css"==a?t.write('<link href="'+data.global.header[a][i]+'" rel="stylesheet">'):t.write('<script src="'+data.global.header[a][i]+'"><\/script>')}t.write("<!DOCTYPE HTML><html><head>"),t.write(data.global.header.meta),a("css"),a("js"),t.write("</head><body>")}var s=url.parse(a.url,!0),d=s.pathname;if(function(){data=jsonfile.readFileSync("./data/data.json")}(),console.log("str "+d.substr(d.length-1,1)),"/"!=d.substr(d.length-1,1))return console.log("start"),t.writeHead(301,{Location:d+"/"}),t.end();o(s.pathname),console.log(pathdataarray[1]),"/setting"==pathdataarray[1]?(o(s.pathname),t.write("you're in setting"),t.end()):"/"==s.pathname?fs.readFile("./index.html",function(a,e){return a?(t.writeHead(404),t.end("404 not found")):(t.writeHead(200,{"Content-Type":"text/html"}),t.write(e),t.end())}):function(){var a,e=pathdataarray[1],n=data.path[e];console.log(data.post[n]),void 0!=data.post[n]?(a=data.post[n].content,console.log(a),void 0!=a?(l(),t.write(a),t.end()):(a="."+(a=data.post[n].contentpath),console.log(a),fs.readFile(a,function(a,e){if(a)return console.log("err");l(),t.write(e),t.end()}))):r("html")}();var p=""}).listen(3e3);